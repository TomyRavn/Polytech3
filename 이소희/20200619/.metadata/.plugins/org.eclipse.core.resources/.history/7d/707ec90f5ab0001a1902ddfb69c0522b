<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
 <%
    
//     JSP에서는 기본객체들을 변수선언 없이 사용 가능
//     요청객체 : request, 세션 객체 : session, 서블릿컨텍스트객체 : application
    
// 1. 처음 접속한 사람의 경우, 이름을 입력할 수 있는 폼을 보여주고,
// 이름을 입력한 후 전송 버튼을 누르면, 다시 현재 JSP 파일로 접속
// 2. 이름을 입력한 사람의 경우, "입력한 이름 님, 안녕하세요" 라는 메시지 출력
// 3. 현재까지 이름을 입력한 모든 사용자의 수를 "총 사용자: 00명" 이라고 출력
   


//사용자가 이름을 입력하여 전송한 경우, 그 이름을 세션객체에 "userNick"이름으로 저장
HttpSession session = req.getSession(); // 현재 요청이 속한 세션 객체 가져오기
		// 세션 객체에 "sesCnt"라는 이름으로 저장된 값을 가져오기
		AtomicInteger scnt = (AtomicInteger) session.getAttribute("useNick");
		if (scnt == null) {// 세션 객체에 "sesCnt"라는 이름으로 저장한 적이 없는 경우
			scnt = new AtomicInteger(0); // 0 값을 가진 정수 객체 생성
		}
		scnt.incrementAndGet(); // 정수 값을 1증가
		session.setAttribute("useNick", scnt); // 세션 객체에 "sesCnt"라는 scnt 값을 저장


//세션객체에 이름을 저장할 때마다, 서블릿컨텍스트객체에 "total"이라는 이름으로 1씩 증가
application.setAttribute("total", 2);


%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>속성 저장 연습</title>
</head>
<body>

<!-- 세션에 "userNick"이름으로 저장된 속성값이 없는 사용자인 경우 -->
<!-- <form action=""> -->
<!-- <form action="attr.jsp"> -->
<form action="${pageContext.request.contextPath}/attr.jsp" method="post">

이름 : <input text="text" name="nick"/><br/>
<input type="submit" value="전송" />      
</form>

<!-- 세션에 "userNick"이름으로 저장된 속성값이 있는 사용자인 경우 -->
<h1>${useNick}님, 안녕하세요.</h1>


<h1>총 사용자 :${total}명</h1>
</body>
</html>